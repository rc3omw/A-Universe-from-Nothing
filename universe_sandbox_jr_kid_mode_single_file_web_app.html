<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Universe Sandbox JR</title>
  <style>
    :root { --bg:#0b1020; --panel:#121a2e; --ink:#e6efff; --muted:#9fb3ff; --accent:#7cc5ff; --good:#6ff2a7; --warn:#ffd166; --bad:#ff6b6b }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#090d1a,#0b1020 40%,#0b0f1f);color:var(--ink);font:16px/1.4 system-ui, Segoe UI, Roboto, Helvetica, Arial}
    header{display:flex;gap:.75rem;align-items:center;justify-content:space-between;padding:.8rem 1rem;background:#0c1430;position:sticky;top:0;border-bottom:1px solid #1b2547;z-index:10}
    h1{font-size:1rem;margin:0;letter-spacing:.02em;color:#d8e3ff}
    .badge{font-size:.7rem;padding:.2rem .45rem;border:1px solid #27408b;border-radius:.5rem;color:#bcd1ff}
    .wrap{display:grid;grid-template-columns:320px 1fr;min-height:calc(100vh - 56px)}
    aside{padding:1rem;background:var(--panel);border-right:1px solid #1b2547}
    main{position:relative}
    #world{display:block;width:100%;height:100%;background:radial-gradient(600px 400px at 60% 30%, #121a33 0%, #0b1020 60%);}
    .section{margin:1rem 0}
    .section h2{font-size:.9rem;margin:.2rem 0 .5rem;color:#cfe1ff}
    .row{display:flex;align-items:center;gap:.5rem;margin:.5rem 0}
    .row label{flex:1;color:#c8d6ff}
    .row input[type="range"]{flex:2}
    button{cursor:pointer;background:#16254c;border:1px solid #2a4080;color:#eaf0ff;padding:.5rem .8rem;border-radius:.6rem}
    button:hover{background:#1a2d5a}
    .btn-accent{background:linear-gradient(180deg,#2b6cb0,#27408b);border-color:#3657a1}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem}
    .pill{display:inline-flex;align-items:center;gap:.4rem;padding:.25rem .5rem;border-radius:999px;background:#0e1a38;border:1px solid #1f3166;color:#c8daff;font-size:.75rem}
    .legend{display:flex;gap:.5rem;flex-wrap:wrap}
    .meter{height:10px;border-radius:8px;background:#0b1431;border:1px solid #1e2c59;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,#6bc3ff,#7cf0ff)}
    .board{font-size:.85rem;color:#b8c8ff;background:#0e1834;border:1px solid #1f2c5a;border-radius:.75rem;padding:.6rem}
    .tiny{font-size:.75rem;color:#9fb3ff}
    .foot{position:absolute;bottom:10px;left:10px;background:#0b1431a0;padding:.5rem .7rem;border-radius:.6rem;border:1px solid #1d2a55;font-size:.8rem}
    .toggle{appearance:none;width:36px;height:22px;border-radius:999px;border:1px solid #2d3f79;background:#0e1a38;position:relative}
    .toggle:checked{background:#1a3b72}
    .toggle::after{content:"";position:absolute;top:2px;left:2px;width:18px;height:18px;border-radius:50%;background:#cfe1ff;transition:all .2s}
    .toggle:checked::after{left:16px;background:#9fe3ff}
    a{text-decoration:none;color:#9fe3ff}
  </style>
</head>
<body>
  <header>
    <h1>Universe Sandbox JR <span class="badge">Kid Mode</span></h1>
    <div class="legend">
      <span class="pill"><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#6fa3ff"></span> + spark</span>
      <span class="pill"><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#ff7d7d"></span> − spark</span>
      <span class="pill"><span style="display:inline-block;width:12px;height:12px;border-radius:3px;background:#a1ffd6"></span> atom</span>
    </div>
    <div>
      <button id="btnDownload" class="btn-accent" title="Save this page as a stand‑alone game file">Download .html</button>
    </div>
  </header>
  <div class="wrap">
    <aside>
      <div class="section">
        <h2>1) Start from Nothing</h2>
        <div class="grid">
          <button id="btnCreate" class="btn-accent">Create a ± photon pair</button>
          <button id="btnClear">Back to Nothing</button>
        </div>
        <p class="tiny">We always create <em>pairs</em> with opposite directions so total energy stays ~0 (balance rule).</p>
      </div>

      <div class="section">
        <h2>2) Simple Controls</h2>
        <div class="row"><label>Gravity</label><input id="gravity" type="range" min="0" max="1" step="0.01" value="0.25"></div>
        <div class="row"><label>Rules (stickiness)</label><input id="rules" type="range" min="0" max="1" step="0.01" value="0.35"></div>
        <div class="row"><label>Randomness</label><input id="random" type="range" min="0" max="1" step="0.01" value="0.10"></div>
        <div class="row" style="justify-content:space-between"><label>Show mini‑formulas</label><input id="toggleFormulas" class="toggle" type="checkbox"></div>
      </div>

      <div class="section">
        <h2>3) Quick Presets</h2>
        <div class="grid">
          <button class="preset" data-g="0.05" data-r="0.20" data-x="0.05">Gentle Space</button>
          <button class="preset" data-g="0.35" data-r="0.45" data-x="0.10">Sticky Atoms</button>
          <button class="preset" data-g="0.70" data-r="0.15" data-x="0.15">Heavy Gravity</button>
          <button class="preset" data-g="0.15" data-r="0.20" data-x="0.40">Chaotic Fun</button>
        </div>
      </div>

      <div class="section">
        <h2>Status</h2>
        <div class="board" id="readout">Energy ≈ 0 • Matter: 0 • Sparks: 0 • Atoms: 0</div>
        <div class="row" style="margin-top:.6rem">
          <label style="flex:initial;width:110px">Order</label>
          <div class="meter" style="flex:1"><div id="orderBar" class="bar" style="width:40%"></div></div>
        </div>
      </div>

      <div class="section">
        <h2>Mini‑Lessons</h2>
        <details id="lessons"><summary>Tap to expand</summary>
          <ul class="tiny">
            <li><b>Balance rule:</b> add things in opposite pairs so totals cancel.</li>
            <li><b>Gravity:</b> pulls things together a bit like <i>F ∝ 1/r²</i>.</li>
            <li><b>Atoms form:</b> when opposite sparks hug tightly (your Rules slider).</li>
            <li><b>Randomness:</b> tiny wiggles make surprises happen (like noise).
          </ul>
        </details>
      </div>

      <div class="section tiny">
        <div><b>Teacher Tip:</b> Try a challenge — “Make 5 atoms without chaos &gt; 60%.”</div>
      </div>
    </aside>

    <main>
      <canvas id="world"></canvas>
      <div class="foot" id="formulaBox" style="display:none">
        <div><b>Formulas (kid‑friendly):</b></div>
        <div>E total ≈ 0 (pairs cancel)</div>
        <div>pull ≈ G / r²</div>
        <div>stick if distance &lt; d &amp;&amp; opposite</div>
      </div>
    </main>
  </div>

  <script>
    // --- Canvas setup ---
    const canvas = document.getElementById('world');
    const ctx = canvas.getContext('2d');
    function resize(){ canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight; }
    addEventListener('resize', resize, {passive:true}); resize();

    // --- UI Elements ---
    const gravityEl = document.getElementById('gravity');
    const rulesEl = document.getElementById('rules');
    const randEl = document.getElementById('random');
    const btnCreate = document.getElementById('btnCreate');
    const btnClear = document.getElementById('btnClear');
    const readout = document.getElementById('readout');
    const orderBar = document.getElementById('orderBar');
    const formulaBox = document.getElementById('formulaBox');
    const toggleFormulas = document.getElementById('toggleFormulas');
    const btnDownload = document.getElementById('btnDownload');
    document.querySelectorAll('.preset').forEach(b=>b.addEventListener('click',()=>{
      gravityEl.value=b.dataset.g; rulesEl.value=b.dataset.r; randEl.value=b.dataset.x;
    }));
    toggleFormulas.addEventListener('change',()=>{
      formulaBox.style.display = toggleFormulas.checked ? 'block':'none';
    });

    // --- Download as single HTML file ---
    btnDownload.addEventListener('click', ()=>{
      // Serialize the current document so whatever you see is what you get
      const doctype = '<!DOCTYPE html>\n';
      const html = document.documentElement.outerHTML;
      const blob = new Blob([doctype + html], {type:'text/html'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'universe-sandbox-jr.html';
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 100);
    });

    // --- Simple Universe Model ---
    const sparks = []; // elementary bits (+/-)
    const atoms = [];  // bound pairs
    let sparkCount=0;

    function addPair(){
      const cx = canvas.width*0.5, cy = canvas.height*0.5;
      const spread = 40 + Math.random()*60;
      const angle = Math.random()*Math.PI*2;
      const dx = Math.cos(angle)*spread, dy = Math.sin(angle)*spread;
      const vmag = 1.2 + Math.random()*0.6;
      const vx = Math.cos(angle+Math.PI/2)*vmag;
      const vy = Math.sin(angle+Math.PI/2)*vmag;
      // + spark (blue)
      sparks.push({x:cx+dx,y:cy+dy,vx:+vx,vy:+vy,sign:+1,life:0});
      // − spark (red) opposite momentum for balance
      sparks.push({x:cx-dx,y:cy-dy,vx:-vx,vy:-vy,sign:-1,life:0});
      sparkCount+=2;
    }

    function reset(){
      sparks.length=0; atoms.length=0; sparkCount=0;
    }

    btnCreate.addEventListener('click', addPair);
    btnClear.addEventListener('click', reset);

    // --- Physics Lite ---
    function step(dt){
      const G = parseFloat(gravityEl.value)*20;    // gravity strength
      const STICK = parseFloat(rulesEl.value);     // 0..1
      const RAND = parseFloat(randEl.value)*0.6;   // wiggle
      const stickDist = 14 + 20*STICK;             // how close to bind

      // Random spontaneous tiny pairs (keeps it lively)
      if (Math.random() < 0.01 + RAND*0.02) addPair();

      // Gravity-like attraction between opposite sparks only (kid‑simple)
      for (let i=0;i<sparks.length;i++){
        const a=sparks[i];
        for (let j=i+1;j<sparks.length;j++){
          const b=sparks[j];
          const dx=b.x-a.x, dy=b.y-a.y;
          const r2 = dx*dx+dy*dy + 0.0001;
          const r = Math.sqrt(r2);
          if (a.sign !== b.sign){
            const f = G/r2; // ∝ 1/r²
            const fx = f*dx/r, fy = f*dy/r;
            a.vx += fx*dt; a.vy += fy*dt;
            b.vx -= fx*dt; b.vy -= fy*dt;
            // Try to stick into an "atom"
            if (r < stickDist && Math.random() < 0.6*STICK){
              // merge into a simple bound object at midpoint
              const mx = (a.x+b.x)/2, my=(a.y+b.y)/2;
              atoms.push({x:mx,y:my,vx:(a.vx+b.vx)/2,vy:(a.vy+b.vy)/2,life:0});
              // remove a & b by swapping with end
              sparks.splice(j,1); sparks.splice(i,1); j=i; // adjust indices
            }
          }
        }
      }

      // Integrate sparks
      for (const s of sparks){
        s.vx += (Math.random()-0.5)*RAND*dt;
        s.vy += (Math.random()-0.5)*RAND*dt;
        s.x += s.vx; s.y += s.vy; s.life+=dt;
        // bounce walls
        if (s.x<5||s.x>canvas.width-5) s.vx*=-1;
        if (s.y<5||s.y>canvas.height-5) s.vy*=-1;
      }
      // Integrate atoms (mildly sticky clusters)
      for (const a of atoms){
        a.vx *= (0.995 + 0.004*(1-STICK));
        a.vy *= (0.995 + 0.004*(1-STICK));
        a.x += a.vx; a.y += a.vy; a.life+=dt;
        if (a.x<8||a.x>canvas.width-8) a.vx*=-1;
        if (a.y<8||a.y>canvas.height-8) a.vy*=-1;
      }

      // UI status
      const chaos = Math.min(100, Math.round( (RAND*60 + (1-STICK)*30 + Math.min(60, sparks.length)/2) ));
      const matter = atoms.length;
      readout.textContent = `Energy ≈ 0 • Matter: ${matter} • Sparks: ${sparks.length} • Atoms: ${atoms.length}`;
      orderBar.style.width = `${100-Math.min(95, chaos)}%`;
      orderBar.style.background = chaos<40? 'linear-gradient(90deg,#6ff2a7,#b8ffd9)'
        : chaos<70? 'linear-gradient(90deg,#ffd166,#fff3bf)'
        : 'linear-gradient(90deg,#ff6b6b,#ffd6d6)';
    }

    // --- Drawing ---
    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // atoms glow
      for (const a of atoms){
        ctx.beginPath();
        ctx.fillStyle = 'rgba(161,255,214,0.95)';
        ctx.strokeStyle = 'rgba(160,255,214,0.35)';
        ctx.lineWidth = 6; ctx.arc(a.x,a.y,6,0,Math.PI*2); ctx.stroke();
        ctx.beginPath(); ctx.arc(a.x,a.y,4,0,Math.PI*2); ctx.fill();
      }
      // sparks
      for (const s of sparks){
        ctx.beginPath();
        ctx.fillStyle = s.sign>0? '#6fa3ff' : '#ff7d7d';
        ctx.arc(s.x,s.y,3,0,Math.PI*2); ctx.fill();
      }
    }

    // --- Main loop ---
    let last=performance.now();
    function loop(t){
      const dt = Math.min(0.05, (t-last)/1000); last=t;
      step(dt); draw();
      requestAnimationFrame(loop);
    } requestAnimationFrame(loop);

    // Start with a friendly scene
    setTimeout(()=>{ for(let i=0;i<3;i++) addPair(); }, 500);
  </script>
</body>
</html>
